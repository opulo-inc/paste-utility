var yt=Object.defineProperty;var vt=(t,e,n)=>e in t?yt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ge=(t,e,n)=>vt(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();class wt{constructor(){ge(this,"timeout",async e=>new Promise(n=>setTimeout(n,e)));this.modalObject=document.getElementById("modal"),this.overlay=document.getElementById("overlay"),this.modalTitle=document.getElementById("modal-title"),this.modalContent=document.getElementById("modal-content"),this.modalNumInput=document.getElementById("modal-num-input"),this.modalClose=document.getElementById("modal-close"),this.modalOK=document.getElementById("modal-ok"),this.modalNG=document.getElementById("modal-ng"),this.receivedInput=void 0,this.setupEventListeners()}setupEventListeners(){this.modalClose.addEventListener("click",()=>{this.receivedInput=!1,this.hide()}),this.modalOK.addEventListener("keyup",e=>{e.code==="Enter"&&(e.preventDefault(),this.receivedInput=!0,this.hide())}),this.modalOK.addEventListener("click",()=>{this.receivedInput=!0,this.hide()}),this.modalNG.addEventListener("click",()=>{this.receivedInput=!1,this.hide()})}hide(){this.modalObject.style.display="none",this.overlay.style.display="none"}show(e,n,i){i===void 0&&(i=0),this.modalTitle.innerHTML=e,this.modalContent.innerHTML=n,this.modalObject.style.display="flex",this.overlay.style.display="block",i==0?this.modalNumInput.style.display="none":i==1&&(this.modalNumInput.style.display="block",this.modalNumInput.value=1),this.modalOK.focus();let s=this.waitForUserSelection();return s&&i==1&&(s=this.modalNumInput.value),s}async waitForUserSelection(){for(;this.receivedInput===void 0;)await this.timeout(50);let e=this.receivedInput;return this.receivedInput=void 0,e}}class bt{constructor(){ge(this,"timeout",async e=>new Promise(n=>setTimeout(n,e)));this.toastObject=document.getElementById("toast"),this.toastContent=document.getElementById("toast-content"),this.toastClose=document.getElementById("toast-close"),this.receivedInput=void 0,this.setupEventListeners()}setupEventListeners(){this.toastClose.addEventListener("click",()=>{this.receivedInput=!1})}hide(){this.toastObject.style.display="none"}async waitForUserSelection(){for(;this.receivedInput===void 0;)await this.timeout(50);let e=this.receivedInput;return this.receivedInput=void 0,this.hide(),e}show(e){return this.toastContent.innerHTML=e,this.toastObject.style.display="flex",this.waitForUserSelection()}}class Bt{constructor(e){ge(this,"delay",e=>new Promise(n=>setTimeout(n,e)));this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.consoleDiv=document.getElementById("console"),this.port,this.shouldListen=!0,this.modal=e,this.receiveBuffer=[],this.inspectBuffer=[],this.sentCommandBuffer=[""],this.sentCommandBufferIndex=0,this.okRespTimeout=!1,this.timeoutID=void 0,this.bootCommands=["G90","M260 A112 B1 S1","M260 A109","M260 B48","M260 B27","M260 S1","M260 A112 B2 S1","M260 A109","M260 B48","M260 B27","M260 S1","G0 F35000"]}async appendToConsole(e,n){let i=document.createElement("p"),s=new Date().toISOString(),o="";n?o="[SEND]":o="[RECE]",i.innerHTML=o+" - "+s+" - "+e+`
`,this.consoleDiv.appendChild(i),this.consoleDiv.scrollTop=this.consoleDiv.scrollHeight}clearBuffer(){for(;this.receiveBuffer.length>0;)this.receiveBuffer.shift()}clearInspectBuffer(){for(;this.inspectBuffer.length>0;)this.inspectBuffer.shift()}dec2bin(e){return(e>>>0).toString(2)}async connect(){if(!navigator.serial)return this.modal.show("Browser Support","Please use a browser that supports WebSerial, like Chrome, Opera, or Edge. <a href='https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API#browser_compatibility'>Supported Browsers."),!1;const e=1155;return this.port=await navigator.serial.requestPort({filters:[{usbVendorId:e}]}),console.log("Port Selected."),await this.port.open({baudRate:115200,bufferSize:255,dataBits:8,flowControl:"none",parity:"none",stopBits:1}),console.log("Port Opened."),this.listen(),document.querySelector("#connect").style.background="green",document.querySelector("#connect").style.color="white",document.querySelector("#connect").innerHTML="Connected",this.send(this.bootCommands),this.send(["M150 P255 R255 U255 B255"]),!0}async listen(){var e;for(;(e=this.port)!=null&&e.readable&&this.shouldListen;){console.log("Port is readable: Starting to listen.");let n="";document.getElementById("console");const i=this.port.readable.getReader();try{for(;this.shouldListen;){const{value:s,done:o}=await i.read();if(o){console.log("Closing reader.");break}const l=this.decoder.decode(s);for(n=n.concat(l);n.indexOf(`
`)!=-1;){let r=n.split(`
`);this.receiveBuffer.push(r[0]),this.appendToConsole(r[0],!1),this.inspectBuffer.push(r[0]),n=n.split(`
`).slice(1).join(`
`)}}}catch(s){console.error("Reading error.",s)}finally{i.releaseLock()}}}sleep(e){for(var n=new Date().getTime(),i=0;i<1e7&&!(new Date().getTime()-n>e);i++);}async setOkRespTimeout(){new Promise(e=>{this.timeoutID=setTimeout(()=>{console.log("timeout triggered"),this.okRespTimeout=!0,e()},5e3)})}async send(e){var n;if(console.log("sending: ",e),(n=this.port)!=null&&n.writable){const i=await this.port.writable.getWriter();try{for(const s of e){for(await i.write(this.encoder.encode(s+`
`)),this.setOkRespTimeout(),this.appendToConsole(s,!0),this.clearBuffer();!this.okRespTimeout;){let o=this.receiveBuffer.shift();if(o=="ok"){clearTimeout(this.timeoutID);break}(o="echo:busy: processing")&&(clearTimeout(this.timeoutID),this.setOkRespTimeout()),await new Promise(l=>setTimeout(l,50))}this.okRespTimeout=!1}}finally{i.releaseLock()}}else this.modal.show("Cannot Write","Cannot write to port. Have you connected?")}async sendRepl(){let e=[document.querySelector("#repl-input").value];this.sentCommandBuffer.splice(1,0,e[0]),this.sentCommandBufferIndex=0,this.send(e)}async leftAirOn(){const e=["M106","M106 P1 S255"];await this.send(e)}async leftAirOff(){const e=["M107","M107 P1"];await this.send(e)}async rightAirOn(){const e=["M106 P2 S255","M106 P3 S255"];await this.send(e)}async rightAirOff(){const e=["M107 P2","M107 P3"];await this.send(e)}async ledOn(){const e=["M150 P255 R255 U255 B255"];await this.send(e)}async ledOff(){const e=["M150 P0"];await this.send(e)}async disableSteppers(){const e=["M18"];await this.send(e)}async readLeftVac(){var d;if(!((d=this.port)!=null&&d.writable))return this.modal.show("Cannot Write","Cannot write to port. Have you connected?"),!1;const e=["M260 A112 B1 S1"],n=50;this.clearInspectBuffer();let i,s,o;const l=new RegExp("data:(..)");await this.send(e),this.clearInspectBuffer(),await this.send(["M260 A109 B6 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(n);for(var r=0,h=this.inspectBuffer.length;r<h;r++){let g=this.inspectBuffer[r];if(console.log(this.inspectBuffer),l.test(g)){i=g.match("data:(..)")[1];break}}this.clearInspectBuffer(),await this.send(["M260 A109 B7 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(n);for(var r=0,h=this.inspectBuffer.length;r<h;r++){let T=this.inspectBuffer[r];if(l.test(T)){s=T.match("data:(..)")[1];break}}this.clearInspectBuffer(),await this.send(["M260 A109 B8 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(n);for(var r=0,h=this.inspectBuffer.length;r<h;r++){let T=this.inspectBuffer[r];if(l.test(T)){o=T.match("data:(..)")[1];break}}console.log(i,s,o);let u=parseInt(i+s+o,16);u&1<<23&&(u=u-2**24),await this.modal.show("Left Vacuum Sensor Value",u),this.clearInspectBuffer()}async readRightVac(){var d;if(!((d=this.port)!=null&&d.writable))return this.modal.show("Cannot Write","Cannot write to port. Have you connected?"),!1;const e=["M260 A112 B2 S1"];let n,i,s;const o=new RegExp("data:(..)"),l=50;this.clearInspectBuffer(),await this.send(e),await this.delay(l),this.clearInspectBuffer(),await this.send(["M260 A109 B6 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(l);for(var r=0,h=this.inspectBuffer.length;r<h;r++){let g=this.inspectBuffer[r];if(o.test(g)){n=g.match("data:(..)")[1];break}}this.clearInspectBuffer(),await this.send(["M260 A109 B7 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(l);for(var r=0,h=this.inspectBuffer.length;r<h;r++){let T=this.inspectBuffer[r];if(o.test(T)){i=T.match("data:(..)")[1];break}}this.clearInspectBuffer(),await this.send(["M260 A109 B8 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(l);for(var r=0,h=this.inspectBuffer.length;r<h;r++){let T=this.inspectBuffer[r];if(o.test(T)){s=T.match("data:(..)")[1];break}}let u=parseInt(n+i+s,16);u&1<<23&&(u=u-2**24),await this.modal.show("Right Vacuum Sensor Value",u),this.clearInspectBuffer()}async testTMC(){var s;if(!((s=this.port)!=null&&s.writable))return this.modal.show("Cannot Write","Cannot write to port. Have you connected?"),!1;let e="";const n=["M122"];await this.clearBuffer(),await this.send(n),await this.delay(5e3),console.log(this.receiveBuffer);for(let o=0;o<this.receiveBuffer.length;o++)e=e.concat(this.receiveBuffer[o]+`
`);if(await this.modal.show("Stepper Driver Test Complete","Test is complete. Click OK to download test report.")==!0){let o=new Date().toISOString();o=o+"-tmctest.txt",this.download(o,e)}}async testVac(){var E;if(!((E=this.port)!=null&&E.writable))return this.modal.show("Cannot Write","Cannot write to port. Have you connected?"),!1;let e="";const n=["M260 A112 B1 S1","M260 A109","M260 B48","M260 B10","M260 S1"],i=["M260 A112 B2 S1","M260 A109","M260 B48","M260 B10","M260 S1"],s=100;this.clearBuffer();let o,l,r;const h=new RegExp("data:(..)");await this.send(n),await this.send(["M260 A109 B6 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(s);for(var u=0,d=this.receiveBuffer.length;u<d;u++){let S=this.receiveBuffer[u];if(h.test(S)){o=S.match("data:(..)")[1],e=e.concat("Left MSB - "+o+`
`);break}}this.clearBuffer(),await this.send(["M260 A109 B7 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(s);for(var u=0,d=this.receiveBuffer.length;u<d;u++){let R=this.receiveBuffer[u];if(h.test(R)){l=R.match("data:(..)")[1],e=e.concat("Left CSB - "+l+`
`);break}}this.clearBuffer(),await this.send(["M260 A109 B8 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(s);for(var u=0,d=this.receiveBuffer.length;u<d;u++){let R=this.receiveBuffer[u];if(h.test(R)){r=R.match("data:(..)")[1],e=e.concat("Left LSB - "+r+`
`);break}}let g=parseInt(o+l+r,16);g&1<<23&&(g=g-2**24),e=e.concat("Left Val - "+g+`
`),this.clearBuffer(),await this.send(i),await this.send(["M260 A109 B6 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(s);for(var u=0,d=this.receiveBuffer.length;u<d;u++){let R=this.receiveBuffer[u];if(h.test(R)){o=R.match("data:(..)")[1],e=e.concat("Right MSB - "+o+`
`);break}}this.clearBuffer(),await this.send(["M260 A109 B7 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(s);for(var u=0,d=this.receiveBuffer.length;u<d;u++){let R=this.receiveBuffer[u];if(h.test(R)){l=R.match("data:(..)")[1],e=e.concat("Right CSB - "+l+`
`);break}}this.clearBuffer(),await this.send(["M260 A109 B8 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(s),console.log("current buffer length: ",this.receiveBuffer.length);for(var u=0,d=this.receiveBuffer.length;u<d;u++){let R=this.receiveBuffer[u];if(h.test(R)){r=R.match("data:(..)")[1],e=e.concat("Right LSB - "+r+`
`);break}}let k=parseInt(o+l+r,16);if(k&1<<23&&(k=k-2**24),e=e.concat("Right Val - "+k+`
`),console.log(g,k),await this.modal.show("Vacuum Sensor Test Complete","Test is complete. Click OK to download test report.")==!0){let S=new Date().toISOString();S=S+"-vactest.txt",this.download(S,e)}}download(e,n){var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),i.setAttribute("download",e),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}async goToRelative(e,n){await this.send(["G91",`G0 X${e} Y${n}`,"G90"])}async goTo(e,n){await this.send([`G0 X${e} Y${n}`])}}function Et(t){window.cv?window.cv.then(e=>t(e)):window.onOpenCVReady=()=>{window.cv.then(e=>t(e))}}class xt{constructor(e){this.cv=e,this.video=null,this.canvas=null,this.frame=null,this.cvFrame=null,this.displayCv=!1,this.cvDisplayTimer=null}async populateCameraList(e){try{const i=(await navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="videoinput");e.innerHTML="",i.forEach(s=>{const o=document.createElement("option");o.value=s.deviceId,o.text=s.label||`Camera ${i.indexOf(s)+1}`,e.appendChild(o),s.label&&s.label.toLowerCase().includes("top")&&(e.value=s.deviceId)})}catch(n){console.error("Error populating camera list:",n)}}async startVideo(e,n){const i=await navigator.mediaDevices.getUserMedia({video:{deviceId:e?{exact:e}:void 0}});this.video=document.createElement("video"),this.video.srcObject=i,this.video.setAttribute("playsinline",!0),this.canvas=n,await new Promise(s=>{this.video.onloadedmetadata=()=>{this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,s()}}),await this.video.play(),this.frame=new this.cv.Mat(this.video.videoHeight,this.video.videoWidth,this.cv.CV_8UC4),this.videoTick()}addReticle(e){const n=e.cols/2,i=e.rows/2,s=20,o=new this.cv.Scalar(255,200,0,255),l=3;let r=e.clone();return this.cv.line(r,new this.cv.Point(n-s,i),new this.cv.Point(n+s,i),o,l),this.cv.line(r,new this.cv.Point(n,i-s),new this.cv.Point(n,i+s),o,l),r}showFrame(e){this.cv.imshow(this.canvas,e)}CVdetectCircle(){try{this.cvFrame=this.frame.clone();let e=new this.cv.Mat;this.cv.cvtColor(this.cvFrame,e,this.cv.COLOR_RGBA2GRAY),this.cv.GaussianBlur(e,e,new this.cv.Size(9,9),2,2);let n=new this.cv.Mat;this.cv.HoughCircles(e,n,this.cv.HOUGH_GRADIENT,1,e.rows/8,50,30,1,50);let i=null;if(n.cols>0){const s=n.data32F[0],o=n.data32F[1],l=n.data32F[2];i=[s,o,l],this.cv.circle(this.cvFrame,new this.cv.Point(s,o),3,new this.cv.Scalar(0,255,0,255),-1),this.cv.circle(this.cvFrame,new this.cv.Point(s,o),l,new this.cv.Scalar(255,0,0,255),3)}return e.delete(),n.delete(),this.addReticle(this.cvFrame),i}catch(e){return console.error("Error in detectCircle:",e),null}}loadNewFrame(){const e=this.canvas.getContext("2d");e.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight);const n=e.getImageData(0,0,this.video.videoWidth,this.video.videoHeight),i=this.cv.matFromImageData(n);i.copyTo(this.frame),i.delete(),this.cv.flip(this.frame,this.frame,-1)}videoTick(){this.displayCv?this.showFrame(this.cvFrame):(this.loadNewFrame(),this.frame=this.addReticle(this.frame),this.showFrame(this.frame)),requestAnimationFrame(()=>this.videoTick())}displayCvFrame(e){this.displayCv=!0,this.processTimer&&clearTimeout(this.processTimer),this.processTimer=setTimeout(()=>{this.displayCv=!1,this.needsCv=!1,this.cvFrame&&(this.cvFrame.delete(),this.cvFrame=null),this.processTimer=null},e)}stopVideo(e){this.isProcessing=!1,this.processTimer&&(clearTimeout(this.processTimer),this.processTimer=null),this.processedFrame&&(this.processedFrame.delete(),this.processedFrame=null),this.video&&this.video.srcObject&&(this.video.srcObject.getTracks().forEach(i=>i.stop()),this.video.remove(),this.video=null),this.src&&(this.src.delete(),this.src=null),this.dst&&(this.dst.delete(),this.dst=null),e.getContext("2d").clearRect(0,0,e.width,e.height),console.log("Video stopped and cleaned up")}}var It=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Te={},Ct={get exports(){return Te},set exports(t){Te=t}};(function(t){(function(e,n){t.exports?t.exports=n():e.moo=n()})(It,function(){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,i=typeof new RegExp().sticky=="boolean";function s(c){return c&&n.call(c)==="[object RegExp]"}function o(c){return c&&typeof c=="object"&&!s(c)&&!Array.isArray(c)}function l(c){return c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function r(c){var f=new RegExp("|"+c);return f.exec("").length-1}function h(c){return"("+c+")"}function u(c){if(!c.length)return"(?!)";var f=c.map(function(p){return"(?:"+p+")"}).join("|");return"(?:"+f+")"}function d(c){if(typeof c=="string")return"(?:"+l(c)+")";if(s(c)){if(c.ignoreCase)throw new Error("RegExp /i flag not allowed");if(c.global)throw new Error("RegExp /g flag is implied");if(c.sticky)throw new Error("RegExp /y flag is implied");if(c.multiline)throw new Error("RegExp /m flag is implied");return c.source}else throw new Error("Not a pattern: "+c)}function g(c,f){return c.length>f?c:Array(f-c.length+1).join(" ")+c}function k(c,f){for(var p=c.length,m=0;;){var v=c.lastIndexOf(`
`,p-1);if(v===-1||(m++,p=v,m===f)||p===0)break}var y=m<f?0:p+1;return c.substring(y).split(`
`)}function T(c){for(var f=Object.getOwnPropertyNames(c),p=[],m=0;m<f.length;m++){var v=f[m],y=c[v],b=[].concat(y);if(v==="include"){for(var F=0;F<b.length;F++)p.push({include:b[F]});continue}var M=[];b.forEach(function(w){o(w)?(M.length&&p.push(S(v,M)),p.push(S(v,w)),M=[]):M.push(w)}),M.length&&p.push(S(v,M))}return p}function E(c){for(var f=[],p=0;p<c.length;p++){var m=c[p];if(m.include){for(var v=[].concat(m.include),y=0;y<v.length;y++)f.push({include:v[y]});continue}if(!m.type)throw new Error("Rule has no type: "+JSON.stringify(m));f.push(S(m.type,m))}return f}function S(c,f){if(o(f)||(f={match:f}),f.include)throw new Error("Matching rules cannot also include states");var p={defaultType:c,lineBreaks:!!f.error||!!f.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var m in f)e.call(f,m)&&(p[m]=f[m]);if(typeof p.type=="string"&&c!==p.type)throw new Error("Type transform cannot be a string (type '"+p.type+"' for token '"+c+"')");var v=p.match;return p.match=Array.isArray(v)?v:v?[v]:[],p.match.sort(function(y,b){return s(y)&&s(b)?0:s(b)?-1:s(y)?1:b.length-y.length}),p}function D(c){return Array.isArray(c)?E(c):T(c)}var R=S("error",{lineBreaks:!0,shouldThrow:!0});function $(c,f){for(var p=null,m=Object.create(null),v=!0,y=null,b=[],F=[],M=0;M<c.length;M++)c[M].fallback&&(v=!1);for(var M=0;M<c.length;M++){var w=c[M];if(w.include)throw new Error("Inheritance is not allowed in stateless lexers");if(w.error||w.fallback){if(p)throw!w.fallback==!p.fallback?new Error("Multiple "+(w.fallback?"fallback":"error")+" rules not allowed (for token '"+w.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+w.defaultType+"')");p=w}var A=w.match.slice();if(v)for(;A.length&&typeof A[0]=="string"&&A[0].length===1;){var ie=A.shift();m[ie.charCodeAt(0)]=w}if(w.pop||w.push||w.next){if(!f)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+w.defaultType+"')");if(w.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+w.defaultType+"')")}if(A.length!==0){v=!1,b.push(w);for(var q=0;q<A.length;q++){var U=A[q];if(s(U)){if(y===null)y=U.unicode;else if(y!==U.unicode&&w.fallback===!1)throw new Error("If one rule is /u then all must be")}}var oe=u(A.map(d)),Y=new RegExp(oe);if(Y.test(""))throw new Error("RegExp matches empty string: "+Y);var ue=r(oe);if(ue>0)throw new Error("RegExp has capture groups: "+Y+`
Use (?: … ) instead`);if(!w.lineBreaks&&Y.test(`
`))throw new Error("Rule should declare lineBreaks: "+Y);F.push(h(oe))}}var re=p&&p.fallback,de=i&&!re?"ym":"gm",me=i||re?"":"|";y===!0&&(de+="u");var gt=new RegExp(u(F)+me,de);return{regexp:gt,groups:b,fast:m,error:p||R}}function B(c){var f=$(D(c));return new N({start:f},"start")}function j(c,f,p){var m=c&&(c.push||c.next);if(m&&!p[m])throw new Error("Missing state '"+m+"' (in token '"+c.defaultType+"' of state '"+f+"')");if(c&&c.pop&&+c.pop!=1)throw new Error("pop must be 1 (in token '"+c.defaultType+"' of state '"+f+"')")}function z(c,f){var p=c.$all?D(c.$all):[];delete c.$all;var m=Object.getOwnPropertyNames(c);f||(f=m[0]);for(var v=Object.create(null),y=0;y<m.length;y++){var b=m[y];v[b]=D(c[b]).concat(p)}for(var y=0;y<m.length;y++)for(var b=m[y],F=v[b],M=Object.create(null),w=0;w<F.length;w++){var A=F[w];if(A.include){var ie=[w,1];if(A.include!==b&&!M[A.include]){M[A.include]=!0;var q=v[A.include];if(!q)throw new Error("Cannot include nonexistent state '"+A.include+"' (in state '"+b+"')");for(var U=0;U<q.length;U++){var oe=q[U];F.indexOf(oe)===-1&&ie.push(oe)}}F.splice.apply(F,ie),w--}}for(var Y=Object.create(null),y=0;y<m.length;y++){var b=m[y];Y[b]=$(v[b],!0)}for(var y=0;y<m.length;y++){for(var ue=m[y],re=Y[ue],de=re.groups,w=0;w<de.length;w++)j(de[w],ue,Y);for(var me=Object.getOwnPropertyNames(re.fast),w=0;w<me.length;w++)j(re.fast[me[w]],ue,Y)}return new N(Y,f)}function xe(c){for(var f=typeof Map<"u",p=f?new Map:Object.create(null),m=Object.getOwnPropertyNames(c),v=0;v<m.length;v++){var y=m[v],b=c[y],F=Array.isArray(b)?b:[b];F.forEach(function(M){if(typeof M!="string")throw new Error("keyword must be string (in keyword '"+y+"')");f?p.set(M,y):p[M]=y})}return function(M){return f?p.get(M):p[M]}}var N=function(c,f){this.startState=f,this.states=c,this.buffer="",this.stack=[],this.reset()};N.prototype.reset=function(c,f){return this.buffer=c||"",this.index=0,this.line=f?f.line:1,this.col=f?f.col:1,this.queuedToken=f?f.queuedToken:null,this.queuedText=f?f.queuedText:"",this.queuedThrow=f?f.queuedThrow:null,this.setState(f?f.state:this.startState),this.stack=f&&f.stack?f.stack.slice():[],this},N.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedText:this.queuedText,queuedThrow:this.queuedThrow}},N.prototype.setState=function(c){if(!(!c||this.state===c)){this.state=c;var f=this.states[c];this.groups=f.groups,this.error=f.error,this.re=f.regexp,this.fast=f.fast}},N.prototype.popState=function(){this.setState(this.stack.pop())},N.prototype.pushState=function(c){this.stack.push(this.state),this.setState(c)};var Ie=i?function(c,f){return c.exec(f)}:function(c,f){var p=c.exec(f);return p[0].length===0?null:p};N.prototype._getGroup=function(c){for(var f=this.groups.length,p=0;p<f;p++)if(c[p+1]!==void 0)return this.groups[p];throw new Error("Cannot find token type for matched text")};function Ce(){return this.value}if(N.prototype.next=function(){var c=this.index;if(this.queuedGroup){var f=this._token(this.queuedGroup,this.queuedText,c);return this.queuedGroup=null,this.queuedText="",f}var p=this.buffer;if(c!==p.length){var b=this.fast[p.charCodeAt(c)];if(b)return this._token(b,p.charAt(c),c);var m=this.re;m.lastIndex=c;var v=Ie(m,p),y=this.error;if(v==null)return this._token(y,p.slice(c,p.length),c);var b=this._getGroup(v),F=v[0];return y.fallback&&v.index!==c?(this.queuedGroup=b,this.queuedText=F,this._token(y,p.slice(c,v.index),c)):this._token(b,F,c)}},N.prototype._token=function(c,f,p){var m=0;if(c.lineBreaks){var v=/\n/g,y=1;if(f===`
`)m=1;else for(;v.exec(f);)m++,y=v.lastIndex}var b={type:typeof c.type=="function"&&c.type(f)||c.defaultType,value:typeof c.value=="function"?c.value(f):f,text:f,toString:Ce,offset:p,lineBreaks:m,line:this.line,col:this.col},F=f.length;if(this.index+=F,this.line+=m,m!==0?this.col=F-y+1:this.col+=F,c.shouldThrow){var M=new Error(this.formatError(b,"invalid syntax"));throw M}return c.pop?this.popState():c.push?this.pushState(c.push):c.next&&this.setState(c.next),b},typeof Symbol<"u"&&Symbol.iterator){var ce=function(c){this.lexer=c};ce.prototype.next=function(){var c=this.lexer.next();return{value:c,done:!c}},ce.prototype[Symbol.iterator]=function(){return this},N.prototype[Symbol.iterator]=function(){return new ce(this)}}return N.prototype.formatError=function(m,f){if(m==null)var p=this.buffer.slice(this.index),m={text:p,offset:this.index,lineBreaks:p.indexOf(`
`)===-1?0:1,line:this.line,col:this.col};var v=2,y=Math.max(m.line-v,1),b=m.line+v,F=String(b).length,M=k(this.buffer,this.line-m.line+v+1).slice(0,5),w=[];w.push(f+" at line "+m.line+" col "+m.col+":"),w.push("");for(var A=0;A<M.length;A++){var ie=M[A],q=y+A;w.push(g(String(q),F)+"  "+ie),q===m.line&&w.push(g("",F+m.col+1)+"^")}return w.join(`
`)},N.prototype.clone=function(){return new N(this.states,this.state)},N.prototype.has=function(c){return!0},{compile:B,states:z,error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:xe}})})(Ct);const $e=Te,he="T_CODE",I="G_CODE",W="M_CODE",V="D_CODE",P="ASTERISK",G="PERCENT",ze="EQUALS",ae="COMMA",Q="OPERATOR",Se="GERBER_FORMAT",ve="GERBER_UNITS",qe="GERBER_TOOL_MACRO",Ve="GERBER_TOOL_DEF",_e="GERBER_LOAD_POLARITY",He="GERBER_STEP_REPEAT",fe="GERBER_MACRO_VARIABLE",Je="SEMICOLON",Ze="DRILL_UNITS",Pe="DRILL_ZERO_INCLUSION",O="COORD_CHAR",L="NUMBER",kt="WORD",Mt="WHITESPACE",_="NEWLINE",Tt="CATCHALL",St="ERROR",Pt=/^0*/,We=t=>t.replace(Pt,""),ye=t=>We(t.slice(1))||"0",Ft={[he]:{match:/T\d+/,value:ye},[I]:{match:/G\d+/,value:ye},[W]:{match:/M\d+/,value:ye},[V]:{match:/D\d+/,value:ye},[P]:"*",[G]:"%",[ze]:"=",[Se]:{match:/FS[LTDAI]+/,value:t=>t.slice(2)},[ve]:{match:/MO(?:IN|MM)/,value:t=>t.slice(2)},[qe]:{match:/AM[a-zA-Z_.$][\w.-]*/,value:t=>t.slice(2)},[Ve]:{match:/ADD\d+[a-zA-Z_.$][\w.-]*/,value:t=>We(t.slice(3))},[_e]:{match:/LP[DC]/,value:t=>t.slice(2)},[He]:"SR",[fe]:/\$\d+/,[Je]:";",[Ze]:/^(?:METRIC|INCH)/,[Pe]:{match:/,(?:TZ|LZ)/,value:t=>t.slice(1)},[O]:/[XYIJACFSBHZN]/,[L]:/[+-]?[\d.]+/,[Q]:["x","/","+","-","(",")"],[ae]:",",[kt]:/[a-zA-Z]+/,[Mt]:/[ \t]+/,[_]:{match:/\r?\n/,lineBreaks:!0},[Tt]:/\S/,[St]:$e.error};function Rt(){const t=$e.compile(Ft);return{feed:e};function e(i,s=null){return t.reset(i,s??void 0),n((s==null?void 0:s.offset)??0)}function n(i){return{[Symbol.iterator](){return this},next(){const s=t.next();if(s){const o={...s,offset:i+s.offset},l={...t.save(),offset:i+(t.index??0)};return{value:[o,l]}}return{value:void 0,done:!0}}}}}const Ue="gerber",Fe="drill",Re="mm",Oe="in",Ke="leading",Qe="trailing",Ot="absolute",Lt="incremental",Le="circle",et="rectangle",At="obround",jt="polygon",Dt="macroShape",Nt="shape",tt="move",Gt="segment",Xt="slot",Yt="line",$t="cwArc",zt="ccwArc",qt="single",Vt="multi",_t="dark",Ht="clear",we="TOKEN",Z="MIN_TO_MAX";function a(t,e){return{rule:we,type:t,value:e}}function te(t,e){return{rule:we,type:t,value:e,negate:!0}}function J(t){return{rule:Z,min:1,max:1,match:t}}function pe(t){return{rule:Z,min:0,max:1,match:t}}function H(t){return{rule:Z,min:0,max:Number.POSITIVE_INFINITY,match:t}}function nt(t){return{rule:Z,min:1,max:Number.POSITIVE_INFINITY,match:t}}function ne(t,e,n){return{rule:Z,min:t,max:e,match:n}}function st(t,e){const n=[];for(const i of e){const s=Zt(t,i.rules);if(s===ot)n.push(i);else if(s===it)return{filetype:i.filetype,nodes:i.createNodes(t)}}return n.length>0?{candidates:n,tokens:t}:{}}const it="FULL_MATCH",ot="PARTIAL_MATCH",Jt="NO_MATCH";function Zt(t,e){let n=0,i=0,s=0;for(;n<e.length&&i<t.length;){const o=e[n],l=t[i];if(rt(o,l))o.rule===we||o.rule===Z&&s>=o.max-1?(n++,i++,s=0):o.rule===Z&&(i++,s++);else if(o.rule===Z&&s>=o.min)s=0,n++;else return Jt}return n<e.length?ot:it}function rt(t,e){if(t.rule===we){const n=t.type===e.type,i=t.value===null||typeof t.value>"u"||typeof t.value=="string"&&t.value===e.value||t.value instanceof RegExp&&t.value.test(e.value),s=n&&i;return t.negate?!s:s}return Array.isArray(t.match)?t.match.some(n=>rt(n,e)):!1}const Wt="root",at="comment",Ut="drillHeader",lt="done",Ae="units",ct="coordinateFormat",ut="toolDefinition",Kt="toolMacro",je="toolChange",Qt="loadPolarity",en="stepRepeat",De="graphic",be="interpolateMode",tn="regionMode",nn="quadrantMode",sn="unimplemented",on="macroComment",rn="macroVariable",an="macroPrimitive";function se(t){return Object.fromEntries(t.map((e,n)=>[e,t[n-1]]).filter(([e,n])=>e.type===L&&(n==null?void 0:n.type)===O).map(([e,n])=>[n.value.toLowerCase(),e.value]))}function Be(t){return t.filter(e=>e.type===I).map(e=>e.value==="0"?tt:e.value==="1"?Yt:e.value==="2"?$t:e.value==="3"?zt:e.value==="5"?Fe:null)[0]??null}function ln(t){return t.filter(e=>e.type===V).map(e=>e.value==="1"?Gt:e.value==="2"?tt:e.value==="3"?Nt:null)[0]??null}function Ne(t){return t.map(e=>e.value).join("").trim()}function C(t,e={}){const{head:n=t[0],length:i=0}=e,s=i>0?t[t.indexOf(n)+i-1]:t[t.length-1];return{start:{line:n.line,column:n.col,offset:n.offset},end:{line:s.line,column:s.col,offset:s.offset}}}const cn={name:"units",rules:[J([a(Ze),a(W,"71"),a(W,"72")]),H([a(ae),a(Pe),a(L,/^0{1,8}\.0{1,8}$/)]),a(_)],createNodes(t){const e=t[0].value==="INCH"||t[0].value==="72"?Oe:Re,n=t.filter(o=>o.type===Pe).map(o=>o.value==="LZ"?Qe:o.value==="TZ"?Ke:null),i=t.filter(o=>o.type===L).map(o=>{const[l="",r=""]=o.value.split(".");return[l.length,r.length]}),s=[{type:Ae,position:C(t.slice(0,2)),units:e}];return(n.length>0||i.length>0)&&s.push({type:ct,position:C(t.slice(1)),mode:null,format:i[0]??null,zeroSuppression:n[0]??null}),s}},un={name:"tool",rules:[a(he),ne(0,12,[a(O,"C"),a(O,"F"),a(O,"S"),a(O,"B"),a(O,"H"),a(O,"Z"),a(L)]),a(_)],createNodes(t){const e=t[0].value,n=C(t),{c:i=null}=se(t.slice(1,-1)),s=i===null?null:{type:Le,diameter:Number(i)};return s?[{type:ut,hole:null,position:n,shape:s,code:e}]:[{type:je,position:n,code:e}]}},dn={name:"operationMode",rules:[J([a(I,"0"),a(I,"1"),a(I,"2"),a(I,"3"),a(I,"5")]),a(_)],createNodes:t=>[{type:be,position:C(t),mode:Be(t)}]},hn={name:"operation",rules:[ne(0,2,[a(he),a(I,"0"),a(I,"1"),a(I,"2"),a(I,"3"),a(I,"5")]),ne(2,8,[a(O),a(L)]),pe([a(he)]),a(_)],createNodes(t){const e=t.filter(g=>g.type===O||g.type===L),n=t.find(g=>g.type===I),i=t.find(g=>g.type===he),s=se(e),o=i?i.value:null,l=Be(t),r=C(t,{head:e[0],length:e.length+1}),h=C(t,{head:n,length:2}),u=C(t,{head:i,length:2}),d=[{type:De,position:r,graphic:null,coordinates:s}];return l&&d.unshift({type:be,position:h,mode:l}),o&&d.unshift({type:je,position:u,code:o}),d}},fn={name:"slot",rules:[ne(2,4,[a(O),a(L)]),a(I,"85"),ne(2,4,[a(O),a(L)]),a(_)],createNodes(t){const e=t.find(o=>o.type===I),n=e?t.indexOf(e):-1,i=Object.fromEntries(Object.entries(se(t.slice(0,n))).map(([o,l])=>[`${o}0`,l])),s=se(t.slice(n));return[{type:De,position:C(t),graphic:Xt,coordinates:{...i,...s}}]}},pn={name:"done",rules:[J([a(W,"30"),a(W,"0")]),a(_)],createNodes:t=>[{type:lt,position:C(t)}]},mn={name:"header",rules:[J([a(W,"48"),a(G)]),a(_)],createNodes:t=>[{type:Ut,position:C(t)}]},gn={name:"comment",rules:[a(Je),H([te(_)]),a(_)],createNodes:t=>[{type:at,comment:Ne(t.slice(1,-1)),position:C(t)}]},dt=[un,dn,hn,fn,gn,cn,pn,mn].map(t=>({...t,filetype:Fe})),yn={name:"macroComment",rules:[a(L,"0"),H([te(P)]),a(P)],createNodes:bn},vn={name:"macroVariable",rules:[a(fe),a(ze),nt([a(L),a(Q),a(fe),a(O,"X")]),a(P)],createNodes:En},wn={name:"macroPrimitive",rules:[a(L),a(ae),nt([a(ae),a(L),a(Q),a(fe),a(O,"X")]),a(P)],createNodes:Bn};function bn(t){const e=t.slice(1,-1).map(n=>n.text).join("").trim();return[{type:on,position:C(t),comment:e}]}function Bn(t){const e=t[0].value,n=[[]];let i=n[0];for(const o of t.slice(2,-1))o.type===ae?(i=[],n.push(i)):i.push(o);const s=n.map(o=>ht(o));return[{type:an,position:C(t),code:e,parameters:s}]}function En(t){const e=t[0].value,n=ht(t.slice(2,-1));return[{type:rn,position:C(t),name:e,value:n}]}function ht(t){const e=t.map(l=>l.type===O?{...l,type:Q,value:"x"}:l);return o();function n(){return e[0]??null}function i(){const l=e.shift();if(l.type===L)return Number(l.value);if(l.type===fe)return l.value;const r=o();return e.shift(),r}function s(){let l=i(),r=n();for(;(r==null?void 0:r.type)===Q&&(r.value==="x"||r.value==="/");)e.shift(),l={left:l,right:i(),operator:r.value},r=n();return l}function o(){let l=s(),r=n();for(;(r==null?void 0:r.type)===Q&&(r.value==="+"||r.value==="-")||(r==null?void 0:r.type)===L;){let h="+";r.type===Q&&(e.shift(),h=r.value);const u=s();l={left:l,right:u,operator:h},r=n()}return l}}const Ge=[wn,vn,yn];function xn(t){let e=Ge,n=[];const i=[];for(const s of t){const o=st([...n,s],e);o.nodes&&i.push(...o.nodes),n=o.tokens??[],e=o.candidates??Ge}return i}const ke=t=>{if(t.length===1){const[e]=t;return{type:Le,diameter:e}}if(t.length===2){const[e,n]=t;return{type:et,xSize:e,ySize:n}}return null},In={name:"done",rules:[J([a(W,"0"),a(W,"2")]),a(P)],createNodes:t=>[{type:lt,position:C(t)}]},Cn={name:"comment",rules:[a(I,"4"),H([te(P)]),a(P)],createNodes:t=>[{type:at,position:C(t),comment:Ne(t.slice(1,-1))}]},kn={name:"format",rules:[a(G),a(Se),H([te(O,"X")]),a(O,"X"),a(L),a(O,"Y"),a(L),H([te(P)]),a(P),ne(0,2,[a(ve),a(P)]),a(G)],createNodes(t){var e;let n=null,i=null,s=null;const o=se(t),l=t.findIndex(u=>u.type===P),r=t.find(u=>u.type===ve);for(const u of t.filter(d=>d.type===Se))u.value.includes("T")&&(i=Qe),u.value.includes("L")&&(i=Ke),u.value.includes("I")&&(s=Lt),u.value.includes("A")&&(s=Ot);if(o.x===o.y&&((e=o.x)==null?void 0:e.length)===2){const u=Number(o.x[0]),d=Number(o.x[1]);u&&d&&(n=[u,d])}const h=[{type:ct,position:C(t.slice(1,l+1)),zeroSuppression:i,format:n,mode:s}];return r&&h.push({type:Ae,position:C(t.slice(1,-1),{head:r}),units:r.value==="MM"?Re:Oe}),h}},Mn={name:"units",rules:[a(G),a(ve),a(P),a(G)],createNodes:t=>[{type:Ae,position:C(t.slice(1,-1)),units:t[1].value==="MM"?Re:Oe}]},Tn={name:"toolMacro",rules:[a(G),a(qe),a(P),H([te(G)]),a(G)],createNodes(t){const e=t[1].value,n=C(t.slice(1,-1)),i=t.slice(3,-1);return[{type:Kt,position:n,children:xn(i),name:e}]}},Sn={name:"toolDefinition",rules:[a(G),a(Ve),H([a(ae),a(L),a(O,"X")]),a(P),a(G)],createNodes(t){let e,n=null;const i=/(\d+)(.+)/.exec(t[1].value),[,s="",o=""]=i??[],l=t.slice(3,-2).filter(r=>r.type===L).map(r=>Number(r.value));switch(o){case"C":{const[r,...h]=l;e={type:Le,diameter:r},n=ke(h);break}case"R":case"O":{const[r,h,...u]=l;e={type:o==="R"?et:At,xSize:r,ySize:h},n=ke(u);break}case"P":{const[r,h,u=null,...d]=l;e={type:jt,diameter:r,vertices:h,rotation:u},n=ke(d);break}default:e={type:Dt,name:o,variableValues:l}}return[{type:ut,position:C(t.slice(1,-1)),code:s,shape:e,hole:n}]}},Pn={name:"toolChange",rules:[pe([a(I,"54")]),a(V),a(P)],createNodes:t=>[{type:je,position:C(t),code:t.find(e=>e.type===V).value}]},ft=t=>{const e=ln(t),n=se(t),i=Be(t),s=C(t,{head:i?t[1]:t[0]}),o=[{type:De,position:s,graphic:e,coordinates:n}];if(i){const l=C(t,{head:t[0],length:2});o.unshift({type:be,position:l,mode:i})}return o},Fn={name:"operation",rules:[pe([a(I,"1"),a(I,"2"),a(I,"3")]),ne(2,8,[a(O),a(L)]),pe([a(V,"1"),a(V,"2"),a(V,"3")]),a(P)],createNodes:ft},Rn={name:"operationWithoutCoords",rules:[pe([a(I,"1"),a(I,"2"),a(I,"3")]),J([a(V,"1"),a(V,"2"),a(V,"3")]),a(P)],createNodes:ft},On={name:"interpolationMode",rules:[J([a(I,"1"),a(I,"2"),a(I,"3")]),a(P)],createNodes:t=>[{type:be,position:C(t),mode:Be(t)}]},Ln={name:"regionMode",rules:[J([a(I,"36"),a(I,"37")]),a(P)],createNodes:t=>[{type:tn,position:C(t),region:t[0].value==="36"}]},An={name:"quadrantMode",rules:[J([a(I,"74"),a(I,"75")]),a(P)],createNodes:t=>[{type:nn,position:C(t),quadrant:t[0].value==="74"?qt:Vt}]},jn={name:"loadPolarity",rules:[a(G),a(_e),a(P),a(G)],createNodes:t=>[{type:Qt,position:C(t.slice(1,-1)),polarity:t[1].value==="D"?_t:Ht}]},Dn={name:"stepRepeat",rules:[a(G),a(He),H([a(O),a(L)]),a(P),a(G)],createNodes(t){const e=se(t),n=Object.fromEntries(Object.entries(e).map(([i,s])=>[i,Number(s)]));return[{type:en,position:C(t.slice(1,-1)),stepRepeat:n}]}},Nn={name:"unimplementedExtendedCommand",rules:[a(G),H([te(P)]),a(P),a(G)],createNodes:t=>[{type:sn,position:C(t.slice(1,-1)),value:Ne(t)}]},pt=[Fn,Rn,On,Pn,Sn,Tn,Cn,Ln,An,jn,Dn,kn,Mn,In,Nn].map(t=>({...t,filetype:Ue})),Gn=[...pt,...dt];function Xn(t,e=null){const n=[];let i=r(),s=[],o=null,l="";for(const[h,u]of t){const d=st([...s,h],i);d.nodes?(n.push(...d.nodes),o=u,l=""):l+=h.text,e=e??d.filetype??null,s=d.tokens??[],i=d.candidates??r()}return{filetype:e,unmatched:l,nodes:n,lexerState:o};function r(){return e===Ue?pt:e===Fe?dt:Gn}}function Yn(){const t=Rt(),e=[];let n=null,i=null,s="";const o={lexer:t,feed:l,result:r};return o;function l(h){const u=t.feed(`${s}${h}`,i),d=Xn(u,n);return n=n??d.filetype,s=d.unmatched,i=d.lexerState??i,e.push(...d.nodes),o}function r(){if(n===null)throw new Error("File type not recognized");return{type:Wt,filetype:n,children:e}}}function $n(t){return Yn().feed(t).result()}function zn(t,e){return Array.isArray(e)?[t.a*e[0]+t.c*e[1]+t.e,t.b*e[0]+t.d*e[1]+t.f]:{x:t.a*e.x+t.c*e.y+t.e,y:t.b*e.x+t.d*e.y+t.f}}function qn(t){const{a:e,b:n,c:i,d:s,e:o,f:l}=t,r=e*s-n*i;return{a:s/r,b:n/-r,c:i/-r,d:e/r,e:(s*o-i*l)/-r,f:(n*o-e*l)/r}}function mt(...t){t=Array.isArray(t[0])?t[0]:t;const e=(n,i)=>({a:n.a*i.a+n.c*i.b,c:n.a*i.c+n.c*i.d,e:n.a*i.e+n.c*i.f+n.e,b:n.b*i.a+n.d*i.b,d:n.b*i.c+n.d*i.d,f:n.b*i.e+n.d*i.f+n.f});switch(t.length){case 0:throw new Error("no matrices provided");case 1:return t[0];case 2:return e(t[0],t[1]);default:{const[n,i,...s]=t,o=e(n,i);return mt(o,...s)}}}function Vn(t,e=1e10){return{a:Math.round(t.a*e)/e,b:Math.round(t.b*e)/e,c:Math.round(t.c*e)/e,d:Math.round(t.d*e)/e,e:Math.round(t.e*e)/e,f:Math.round(t.f*e)/e}}function _n(t,e){const n=t[0].x!=null?t[0].x:t[0][0],i=t[0].y!=null?t[0].y:t[0][1],s=e[0].x!=null?e[0].x:e[0][0],o=e[0].y!=null?e[0].y:e[0][1],l=t[1].x!=null?t[1].x:t[1][0],r=t[1].y!=null?t[1].y:t[1][1],h=e[1].x!=null?e[1].x:e[1][0],u=e[1].y!=null?e[1].y:e[1][1],d=t[2].x!=null?t[2].x:t[2][0],g=t[2].y!=null?t[2].y:t[2][1],k=e[2].x!=null?e[2].x:e[2][0],T=e[2].y!=null?e[2].y:e[2][1],E={a:n-d,b:i-g,c:l-d,d:r-g,e:d,f:g},S={a:s-k,b:o-T,c:h-k,d:u-T,e:k,f:T},D=qn(E),R=mt([S,D]);return Vn(R)}function Hn(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function Ee(t,e,n,i){var s=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(s,Ee.prototype),s.expected=e,s.found=n,s.location=i,s.name="SyntaxError",s}Hn(Ee,Error);function Me(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,n+=n.repeat(e),t+n.slice(0,e))}Ee.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n=null,i;for(i=0;i<t.length;i++)if(t[i].source===this.location.source){n=t[i].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,o=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,l=this.location.source+":"+o.line+":"+o.column;if(n){var r=this.location.end,h=Me("",o.line.toString().length," "),u=n[s.line-1],d=s.line===r.line?r.column:u.length+1,g=d-s.column||1;e+=`
 --> `+l+`
`+h+` |
`+o.line+" | "+u+`
`+h+" | "+Me("",s.column-1," ")+Me("",g,"^")}else e+=`
 at `+l}return e};Ee.buildMessage=function(t,e){var n={literal:function(u){return'"'+s(u.text)+'"'},class:function(u){var d=u.parts.map(function(g){return Array.isArray(g)?o(g[0])+"-"+o(g[1]):o(g)});return"["+(u.inverted?"^":"")+d.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(u){return u.description}};function i(u){return u.charCodeAt(0).toString(16).toUpperCase()}function s(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+i(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+i(d)})}function o(u){return u.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+i(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+i(d)})}function l(u){return n[u.type](u)}function r(u){var d=u.map(l),g,k;if(d.sort(),d.length>0){for(g=1,k=1;g<d.length;g++)d[g-1]!==d[g]&&(d[k]=d[g],k++);d.length=k}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function h(u){return u?'"'+s(u)+'"':"end of input"}return"Expected "+r(t)+" but "+h(e)+" found."};class ee{constructor(e,n,i){this.x=e,this.y=n,this.z=i,this.calX=null,this.calY=null,this.canvasX=null,this.canvasY=null,this.docElement=null}toArray(){return[this.x,this.y,this.z]}static fromArray(e){return new ee(e[0],e[1],e[2])}}class Jn extends ee{constructor(e,n,i,s,o){super(e,n,i),this.searchX=s,this.searchY=o}}class Zn{constructor(e,n){this.placements=[],this.fiducials=[],this.dispenseDegrees=30,this.retractionDegrees=1,this.dwellMilliseconds=100,this.lumen=e,this.toast=n,this.jobCanvas=document.getElementById("pointViz"),this.clickedFidBuffer=[]}drawJobToCanvas(){const e=this.jobCanvas.getContext("2d");let n=1/0,i=1/0,s=-1/0,o=-1/0;for(const E of this.placements)n=Math.min(n,E.x),i=Math.min(i,E.y),s=Math.max(s,E.x),o=Math.max(o,E.y);for(const E of this.fiducials)n=Math.min(n,E.x),i=Math.min(i,E.y),s=Math.max(s,E.x),o=Math.max(o,E.y);const l=Math.max(s-n,o-i)*.1;n-=l,i-=l,s+=l,o+=l;const r=s-n,h=o-i,u=this.jobCanvas.width/r,d=this.jobCanvas.height/h,g=Math.min(u,d),k=-n,T=-i;e.clearRect(0,0,this.jobCanvas.width,this.jobCanvas.height),e.fillStyle="blue";for(let E of this.fiducials){const S=(E.x+k)*g,D=(E.y+T)*g;E.canvasX=S,E.canvasY=D,e.beginPath(),e.arc(S,this.jobCanvas.height-D,2,0,Math.PI*2),e.fill()}e.fillStyle="red";for(let E of this.placements){const S=(E.x+k)*g,D=(E.y+T)*g;E.canvasX=S,E.canvasY=D,e.beginPath(),e.arc(S,this.jobCanvas.height-D,2,0,Math.PI*2),e.fill()}}returnClosestFidFromClickCoordinates(e,n){let s=null,o=1/0;for(const l of this.fiducials){const r=Math.sqrt(Math.pow(l.canvasX-e,2)+Math.pow(l.canvasY-n,2));r<10&&r<o&&(o=r,s=l)}return s}async parseGerber(e){const n=document.getElementById(e);if(!n||!n.files[0])return console.error("No file selected"),[];const i=await n.files[0].text(),s=$n(i);console.log(s);let o=[],l,r,h,u;for(const d of s.children)d.type==="graphic"&&d.graphic==="shape"&&(o.push({x:d.coordinates.x/1e6,y:d.coordinates.y/1e6}),(l===void 0||d.coordinates.x/1e6<l)&&(l=d.coordinates.x/1e6),(r===void 0||d.coordinates.y/1e6<r)&&(r=d.coordinates.y/1e6),(h===void 0||d.coordinates.x/1e6>h)&&(h=d.coordinates.x/1e6),(u===void 0||d.coordinates.y/1e6>u)&&(u=d.coordinates.y/1e6));return console.log(o),o}async loadJobFromGerbers(){const e=await this.parseGerber("pasteGerberFile");let n=await this.parseGerber("maskGerberFile");console.log("pastePoints: ",e),console.log("maskPoints: ",n),n=n.filter(h=>!e.includes(h));let i=[];for(const h of n)e.includes(h)||i.push(h);console.log("onlyInMask: ",i);for(const h of e){const u=new ee(h.x,h.y,31.5);this.placements.push(u)}for(const h of i){const u=new ee(h.x,h.y,31.5);this.fiducials.push(u)}this.drawJobToCanvas();function s(h){const u=this.jobCanvas.getBoundingClientRect(),d=h.clientX-u.left,g=this.jobCanvas.height-(h.clientY-u.top);let k=this.returnClosestFidFromClickCoordinates(d,g);if(k!==null){this.toast.receivedInput=k,console.log("her'es the point: ",this.toast.receivedInput);const T=this.jobCanvas.getContext("2d");T.fillStyle="green",T.fillRect(k.canvasX-4,this.jobCanvas.height-k.canvasY-4,8,8)}else console.log("no matching click")}console.log("setting event listener"),this.jobCanvas.addEventListener("click",s.bind(this));const o=await this.toast.show("Please click on FID1 in the display."),l=await this.toast.show("Please click on FID2 in the display."),r=await this.toast.show("Please click on FID3 in the display.");this.jobCanvas.removeEventListener("click",s),this.fiducials=[o,l,r],console.log("fiducials: ",this.fiducials),console.log("placements: ",this.placements),this.loadJobIntoPositionList(),this.drawJobToCanvas()}async findBoardRoughPosition(){await this.toast.show("Please jog the camera to be centered on FID1.");const e=await this.lumen.grabBoardPosition();console.log("fid1Rough: ",e),this.fiducials[0].searchX=parseFloat(e[0]),this.fiducials[0].searchY=parseFloat(e[1]),await this.toast.show("Please jog the camera to be centered on FID2.");const n=await this.lumen.grabBoardPosition();this.fiducials[1].searchX=parseFloat(n[0]),this.fiducials[1].searchY=parseFloat(n[1]),await this.toast.show("Please jog the camera to be centered on FID3.");const i=await this.lumen.grabBoardPosition();this.fiducials[2].searchX=parseFloat(i[0]),this.fiducials[2].searchY=parseFloat(i[1]),await this.toast.show("Please jog the paste extruder tip to just barely touch the board.");let s=await this.lumen.grabBoardPosition();await this.lumen.serial.send(["G0 Z31.5"]),s=parseFloat(s[2])-.2;for(const o of this.placements)o.z=s;console.log("this.fiducials: ",this.fiducials),this.transformPlacements([[this.fiducials[0].searchX,this.fiducials[0].searchY],[this.fiducials[1].searchX,this.fiducials[1].searchY],[this.fiducials[2].searchX,this.fiducials[2].searchY]]),console.log(this.placements),this.loadJobIntoPositionList()}async performTipCalibration(){await this.toast.show("Please jog the camera to be centered on any fiducial.");const e=await this.lumen.grabBoardPosition();await this.lumen.serial.send(["G0 Z31.5"]),await this.lumen.serial.goToRelative(-45,63),await this.lumen.serial.send(["G0 Z46.5"]),await this.toast.show("Please jog the nozzle tip to be perfectly centered on and touching the fiducial.");const n=await this.lumen.grabBoardPosition();await this.lumen.serial.send(["G0 Z31.5"]),this.lumen.tipXoffset=n[0]-e[0],this.lumen.tipYoffset=n[1]-e[1]}async performFiducialCalibration(){if(this.fiducials.length!==3){console.error("No fids in this job, cannot perform fiducial calibration.");return}let e=[];for(let n=0;n<this.fiducials.length;n++){const i=this.fiducials[n];console.log(`Processing fiducial ${n+1}:`,i),console.log("jogging to fid: ",i.searchX,i.searchY);try{await this.lumen.serial.goTo(i.searchX,i.searchY),await new Promise(o=>setTimeout(o,1500)),await this.lumen.jogToFiducial(),await new Promise(o=>setTimeout(o,1500)),await this.lumen.jogToFiducial(),await new Promise(o=>setTimeout(o,1500));const s=await this.lumen.grabBoardPosition();console.log(`Fiducial ${n+1} final position:`,s),e.push([parseFloat(s[0]),parseFloat(s[1])]),i.calX=s[0],i.calY=s[1]}catch(s){throw console.error(`Error processing fiducial ${n+1}:`,s),s}}console.log("All fiducials processed, transforming placements..."),this.transformPlacements(e),console.log("fid cal complete: ",this.fiducials),this.loadJobIntoPositionList()}loadJobIntoPositionList(){const e=document.querySelector(".positions-list");e.innerHTML="";for(let n of this.placements)this.createPositionElement(n,!1);for(let n of this.fiducials)this.createPositionElement(n,!0)}handleFiducialSelectionClick(e){const n=this.jobCanvas.getBoundingClientRect(),i=e.clientX-n.left,s=e.clientY-n.top;let o=this.returnClosestFidFromClickCoordinates(i,s);o&&(ctx.beginPath(),ctx.arc(o.canvasX,n.height-o.canvasY,6,0,Math.PI*2),ctx.fill(),this.clickedFidBuffer.push(o),currentFidIndex++,currentFidIndex<3?updateModalForFid():(modal.style.display="none",overlay.style.display="none",this.fiducials=this.clickedFidBuffer,this.clickedFidBuffer=[],console.log(this.fiducials),canvas.removeEventListener("click",this.handleFiducialSelectionClick)))}async captureNewPosition(){if(console.log("Job capture method called"),!this.lumen.serial){console.error("Serial manager not set");return}console.log("Serial manager is set, proceeding with capture"),this.lumen.serial.clearInspectBuffer(),console.log("Inspect buffer cleared"),await this.lumen.serial.send(["G92"]),console.log("G92 command sent");const e=/X:(.*?) Y:(.*?) Z:(.*?) A:(.*?) B:(.*?) /,n=new RegExp(e,"i");console.log("Serial inspect buffer contents:",this.lumen.serial.inspectBuffer);for(var i=0;i<this.lumen.serial.inspectBuffer.length;i++){let s=this.lumen.serial.inspectBuffer[i];console.log("Checking line:",s);let o=n.test(s);if(console.log("Regex test result:",o),o){const l=n.exec(s);console.log("Position matches:",l),this.addPoint(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),console.log("Point added to job"),this.loadJobIntoPositionList();return}}console.log("No valid position found in inspect buffer")}addPoint(e,n,i){let s=new ee(e,n,i);this.placements.push(s)}async importFromFile(e){try{const n=await new Promise((r,h)=>{const u=new FileReader;u.onload=d=>r(d.target.result),u.onerror=d=>h(d),u.readAsText(e)}),i=JSON.parse(n);this.placements=(i.placements||[]).map(r=>{const h=new ee(r.x,r.y,r.z);return h.calX=r.calX,h.calY=r.calY,h.canvasX=r.canvasX,h.canvasY=r.canvasY,h}),this.fiducials=(i.fiducials||[]).map(r=>{const h=new Jn(r.x,r.y,r.z,r.searchX,r.searchY);return h.calX=r.calX,h.calY=r.calY,h.canvasX=r.canvasX,h.canvasY=r.canvasY,h}),this.dispenseDegrees=i.dispenseDegrees,this.retractionDegrees=i.retractionDegrees,this.dwellMilliseconds=i.dwellMilliseconds,typeof i.tipXoffset<"u"&&(this.lumen.tipXoffset=i.tipXoffset),typeof i.tipYoffset<"u"&&(this.lumen.tipYoffset=i.tipYoffset);const s=document.getElementById("jobDispenseDeg"),o=document.getElementById("jobRetractionDeg"),l=document.getElementById("jobDwellMs");return s&&(s.value=this.dispenseDegrees),o&&(o.value=this.retractionDegrees),l&&(l.value=this.dwellMilliseconds),this.loadJobIntoPositionList(),this.drawJobToCanvas(),{success:!0}}catch(n){return{success:!1,error:n.message||n.toString()}}}async saveToFile(){const e=this.export(),n=new Blob([e],{type:"application/json"}),s=await(await window.showSaveFilePicker({suggestedName:"job.json",types:[{description:"JSON Files",accept:{"application/json":[".json"]}}]})).createWritable();await s.write(n),await s.close()}createPositionElement(e,n){const i=document.querySelector(".positions-list"),s=document.createElement("div");s.className="position-item";let o,l;e.calX!=null&e.calY!=null?(o=e.calX,l=e.calY):e.searchX!=null&e.searchY!=null?(o=e.searchX,l=e.searchY):(o=e.x,l=e.y),n?s.innerHTML=`
            <span class="position-text">Fiducial: X:${o} Y:${l} Z:${e.z}</span>
            <div class="button-group">
                <button class="move-btn">☉</button>
                <button class="remove-btn">X</button>
            </div>
        `:s.innerHTML=`
            <span class="position-text">Position: X:${o} Y:${l} Z:${e.z}</span>
            <div class="button-group">
                <button class="move-btn">☉</button>
                <button class="remove-btn">X</button>
            </div>
        `,s.querySelector(".move-btn").addEventListener("click",()=>{let r,h;e.calX!=null&e.calY!=null?(r=e.calX,h=e.calY):(r=e.x,h=e.y),this.lumen.serial.send(["G90","G0 Z31.5",`G0 X${r} Y${h}`])}),s.querySelector(".remove-btn").addEventListener("click",()=>{s.remove(),this.placements=this.placements.filter(r=>r.x!==e.x||r.y!==e.y||r.z!==e.z),this.fiducials=this.fiducials.filter(r=>r.x!==e.x||r.y!==e.y||r.z!==e.z),this.loadJobIntoPositionList(),this.drawJobToCanvas(),console.log(this.placements)}),i.appendChild(s)}slice(){const e=[];e.push("G90","G92 B0","G0 Z31.5");let n=0;console.log(this.positions);const i=parseFloat(this.dispenseDegrees),s=parseFloat(this.retractionDegrees),o=parseFloat(this.dwellMilliseconds);for(const l of this.placements){const r=n-i,h=r+s;let u=l.x,d=l.y;l.calX!=null&&(u=l.calX),l.calY!=null&&(d=l.calY),e.push(`G0 X${u+this.lumen.tipXoffset} Y${d+this.lumen.tipYoffset}`,`G0 Z${l.z}`,`G0 B${r}`,`G0 B${h}`,`G4 P${o}`,"G0 Z31.5"),n=h}return e.push("G0 X250 Y400"),e}async run(){let e=this.slice();this.toast.show("Running job. Close this to cancel.");for(const n of e){if(console.log(this.toast.receivedInput),this.toast.toastObject.style.display=="none"){await this.lumen.serial.send(["G0 Z31.5"]),await this.lumen.serial.send(["G0 X250 Y400"]);return}await this.lumen.serial.send([n])}this.toast.receivedInput=!1}export(){const e={placements:this.placements.map(n=>({x:n.x,y:n.y,z:n.z,calX:n.calX,calY:n.calY,canvasX:n.canvasX,canvasY:n.canvasY})),fiducials:this.fiducials.map(n=>({x:n.x,y:n.y,z:n.z,calX:n.calX,calY:n.calY,canvasX:n.canvasX,canvasY:n.canvasY,searchX:n.searchX,searchY:n.searchY})),dispenseDegrees:this.dispenseDegrees,retractionDegrees:this.retractionDegrees,dwellMilliseconds:this.dwellMilliseconds,tipXoffset:this.lumen.tipXoffset,tipYoffset:this.lumen.tipYoffset};return JSON.stringify(e,null,2)}transformPlacements(e){const n=[[this.fiducials[0].x,this.fiducials[0].y],[this.fiducials[1].x,this.fiducials[1].y],[this.fiducials[2].x,this.fiducials[2].y]],i=_n(n,e);for(let s of this.placements){let o=zn(i,[s.x,s.y]);s.calX=o[0],s.calY=o[1]}}}class Wn{constructor(e){this.serial=e,this.video=null,this.tipXoffset=0,this.tipYoffset=0}addVideoManager(e){this.video=e}async grabBoardPosition(){console.log("grabbing board position"),this.serial.clearInspectBuffer(),await this.serial.send(["G92"]),console.log("sent G92");const e=/X:(.*?) Y:(.*?) Z:(.*?) A:(.*?) B:(.*?) /,n=new RegExp(e,"i");console.log("serial inspect buffer: ",this.serial.inspectBuffer);let i=[];for(var s=0;s<this.serial.inspectBuffer.length;s++){let o=this.serial.inspectBuffer[s];if(console.log(o),n.test(o)){const r=n.exec(o);i=[r[1],r[2],r[3]];break}}return console.log("positionArray: ",i),i}async jogToFiducial(){const e=this.video.CVdetectCircle();if(this.video.displayCvFrame(1e3),e){const[n,i]=e,s=this.video.canvas.width/2,o=this.video.canvas.height/2,l=n-s,r=-(i-o),h=.02,u=l*h,d=r*h;await this.serial.goToRelative(u.toFixed(1),d.toFixed(1))}}}let Un=new wt,Kn=new bt,x=new Bt(Un),K=new Wn(x),X=new Zn(K,Kn);Et(t=>{console.log("OpenCV loaded");const e=new xt(t);K.addVideoManager(e);const n=document.getElementById("opencv-canvas"),i=document.getElementById("camera-select"),s=document.getElementById("process-button");e.populateCameraList(i);let o=!1;const l=document.getElementById("importJob"),r=document.getElementById("jobFile"),h=document.getElementById("exportJob"),u=document.getElementById("jobDispenseDeg"),d=document.getElementById("jobRetractionDeg"),g=document.getElementById("jobDwellMs");u&&u.addEventListener("change",B=>{console.log("Dispense degrees changed:",B.target.value),X.dispenseDegrees=Number(B.target.value)}),d&&d.addEventListener("change",B=>{console.log("Retraction degrees changed:",B.target.value),X.retractionDegrees=Number(B.target.value)}),g&&g.addEventListener("change",B=>{console.log("Dwell milliseconds changed:",B.target.value),X.dwellMilliseconds=Number(B.target.value)}),l&&r?(l.addEventListener("click",()=>{r.click()}),r.addEventListener("change",async B=>{const j=B.target.files[0];if(j){console.log("Reading file:",j.name);try{const z=await X.importFromFile(j);z.success||(console.error("Failed to import job:",z.error),alert("Failed to import job file: "+z.error))}catch(z){console.error("Error importing job:",z),alert("Error importing job file: "+z.message)}}})):console.error("Import button or file input not found");const k=document.getElementById("selectPasteGerber"),T=document.getElementById("selectMaskGerber"),E=document.getElementById("loadGerbers"),S=document.getElementById("pasteGerberFile"),D=document.getElementById("maskGerberFile"),R=document.getElementById("pasteGerberFilename"),$=document.getElementById("maskGerberFilename");k&&S&&(k.addEventListener("click",()=>{S.click()}),S.addEventListener("change",B=>{const j=B.target.files[0];j?R.textContent=j.name:R.textContent=""})),T&&D&&(T.addEventListener("click",()=>{D.click()}),D.addEventListener("change",B=>{const j=B.target.files[0];j?$.textContent=j.name:$.textContent=""})),E&&E.addEventListener("click",async()=>{if(!S.files[0]||!D.files[0]){alert("Please select both paste and mask gerber files first");return}try{await X.loadJobFromGerbers()}catch(B){console.error("Error loading gerbers:",B),alert("Error loading gerber files: "+B.message)}}),h&&h.addEventListener("click",async()=>{try{u&&(X.dispenseDegrees=Number(u.value)),d&&(X.retractionDegrees=Number(d.value)),g&&(X.dwellMilliseconds=Number(g.value)),await X.saveToFile()}catch(B){B.name!=="AbortError"&&(console.error("Error saving file:",B),alert("Error saving file: "+B.message))}}),n.addEventListener("click",B=>{const j=n.getBoundingClientRect(),z=B.clientX-j.left,xe=B.clientY-j.top,N=n.width/j.width,Ie=n.height/j.height,Ce=z*N,ce=xe*Ie,c=n.width/2,f=n.height/2,p=Ce-c,m=-(ce-f),v=.02,y=p*v,b=m*v;x.goToRelative(y.toFixed(1),b.toFixed(1))}),document.getElementById("connect").addEventListener("click",async()=>{const B=document.getElementById("connect");try{o||(await x.connect(),await e.startVideo(i.value,n),o=!0,B.textContent="Connected",B.classList.add("connected"),B.disabled=!0)}catch(j){alert("Error: "+j.message)}}),s.addEventListener("click",()=>{o&&K.jogToFiducial()}),document.getElementById("homing-fid-button").addEventListener("click",async()=>{await K.serial.goTo(218,196),await new Promise(B=>setTimeout(B,1e3)),await K.jogToFiducial(),await new Promise(B=>setTimeout(B,1500)),await K.jogToFiducial(),await new Promise(B=>setTimeout(B,1500)),K.serial.send(["G92 X218 Y196"])}),document.getElementById("nozzleOffsetCal").addEventListener("click",async()=>{await X.performTipCalibration()})});function Qn(){document.getElementById("repl-input").value=""}document.getElementById("repl-input").addEventListener("keyup",function(t){if(t.code==="Enter")t.preventDefault(),document.getElementById("send").click();else if(t.code==="ArrowUp"){if(t.preventDefault(),x.sentCommandBufferIndex==x.sentCommandBuffer.length-1)return!1;x.sentCommandBufferIndex++,document.getElementById("repl-input").value=x.sentCommandBuffer[x.sentCommandBufferIndex]}else if(t.code==="ArrowDown"){if(t.preventDefault(),x.sentCommandBufferIndex==0)return!1;x.sentCommandBufferIndex--,document.getElementById("repl-input").value=x.sentCommandBuffer[x.sentCommandBufferIndex]}});document.getElementById("send").addEventListener("click",()=>{x.sendRepl(),Qn()});function le(){let t=document.getElementById("jog-distance").value;return t=="1"?.1:t=="2"?1:t=="3"?10:t=="4"?100:1}document.getElementById("jog-yp").addEventListener("click",()=>{let t=le();x.send(["G91",`G0 Y${t}`,"G90"])});document.getElementById("jog-ym").addEventListener("click",()=>{let t=le();x.send(["G91",`G0 Y-${t}`,"G90"])});document.getElementById("jog-xp").addEventListener("click",()=>{let t=le();x.send(["G91",`G0 X${t}`,"G90"])});document.getElementById("jog-xm").addEventListener("click",()=>{let t=le();x.send(["G91",`G0 X-${t}`,"G90"])});document.getElementById("jog-zp").addEventListener("click",()=>{let t=le();x.send(["G91",`G0 Z${t}`,"G90"])});document.getElementById("jog-zm").addEventListener("click",()=>{let t=le();x.send(["G91",`G0 Z-${t}`,"G90"])});const Xe=document.getElementById("extrude-btn"),Ye=document.getElementById("retract-btn");Xe&&Xe.addEventListener("click",()=>{x.send(["G91","G0 B-2","G90"])});Ye&&Ye.addEventListener("click",()=>{x.send(["G91","G0 B2","G90"])});document.getElementById("left-air-on").addEventListener("click",()=>{x.send(["M106","M106 P1 S255"])});document.getElementById("left-air-off").addEventListener("click",()=>{x.send(["M107","M107 P1"])});document.getElementById("left-vac").addEventListener("click",()=>{x.readLeftVac()});document.getElementById("ring-lights-on").addEventListener("click",()=>{x.send(["M150 P255 R255 U255 B255"])});document.getElementById("ring-lights-off").addEventListener("click",()=>{x.send(["M150 P0"])});document.getElementById("disable-steppers").addEventListener("click",()=>{x.send(["M18"])});document.getElementById("home-x").addEventListener("click",()=>{x.send(["G28 X"])});document.getElementById("home-y").addEventListener("click",()=>{x.send(["G28 Y"])});document.getElementById("home-z").addEventListener("click",()=>{x.send(["G28 Z"])});document.getElementById("getRoughBoardPosition").addEventListener("click",async()=>{try{await X.findBoardRoughPosition()}catch(t){console.error("Error during capture:",t)}});document.getElementById("runJob").addEventListener("click",async()=>{try{await X.run()}catch(t){console.error("Error during run:",t)}});document.getElementById("performFidCal").addEventListener("click",async()=>{try{await X.performFiducialCalibration()}catch(t){console.error("Error during fid cal:",t)}});document.getElementById("captureNewPos").addEventListener("click",async()=>{try{await X.captureNewPosition()}catch(t){console.error("Error during pos capture:",t)}});
